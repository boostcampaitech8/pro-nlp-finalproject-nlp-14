# 프로덕션 환경 - 여러 곳에서 참조되는 값만 관리
# 시크릿은 환경변수에서 참조 (deploy.sh에서 .env.prod 로드)

global:
  namespace: mit
  environment: production
  registry: "ghcr.io/teamatoi"

# 이미지 태그 (CI에서 SHA 기반, 환경변수로 오버라이드 가능)
images:
  backend:
    tag: {{ env "BACKEND_TAG" | default "latest" }}
  frontend:
    tag: {{ env "FRONTEND_TAG" | default "latest" }}
  worker:
    tag: {{ env "WORKER_TAG" | default "latest" }}
  pullSecret: "ghcr-secret"  # GHCR Private 레지스트리 인증용

# Ingress (Traefik + Let's Encrypt)
ingress:
  className: traefik
  host: "www.mit-hub.com"
  tls: true
  certManager: true
  clusterIssuer: "letsencrypt-prod"

# 앱 포트
backend:
  port: 8000

frontend:
  port: 80

# Database (외부 서버)
database:
  url: {{ requiredEnv "DATABASE_URL" }}

# Redis
redis:
  host: redis-master
  port: 6379

# Neo4j (외부 서버)
neo4j:
  uri: {{ requiredEnv "NEO4J_URI" }}
  user: neo4j
  password: {{ requiredEnv "NEO4J_PASSWORD" }}

# LiveKit (서비스 이름 lk-server: LIVEKIT_PORT 환경변수 충돌 방지)
# 포트 80: Helm 차트가 서비스 80 → 컨테이너 7880 매핑
livekit:
  host: lk-server
  port: 80
  apiKey: {{ requiredEnv "LIVEKIT_API_KEY" }}
  apiSecret: {{ requiredEnv "LIVEKIT_API_SECRET" }}
  externalUrl: "wss://www.mit-hub.com/livekit"
  webhookUrls:
    - "http://backend:8000/api/v1/livekit/webhook"
  # RTC 설정 (프로덕션: 서버 외부 IP 사용)
  rtc:
    nodeIp: ""  # 빈 문자열 = 자동 감지
    useExternalIp: true
    tcpPort: 7881
    portRangeStart: 50000
    portRangeEnd: 50020

# JWT
jwt:
  secretKey: {{ requiredEnv "JWT_SECRET" }}
  accessTokenExpireMinutes: 30
  refreshTokenExpireDays: 7

# App
app:
  debug: false
  logLevel: INFO
  corsOrigins:
    - "https://mit-hub.com"
    - "https://www.mit-hub.com"

# Worker
worker:
  clovaSttEndpoint: "clovaspeech-gw.ncloud.com:50051"
  clovaSttSecret: {{ requiredEnv "CLOVA_STT_SECRET" }}
  backendApiKey: {{ requiredEnv "BACKEND_API_KEY" }}
  ttsServerUrl: {{ requiredEnv "TTS_SERVER_URL" }}

# NCP Clova Studio
ncp:
  clovaStudioApiKey: {{ requiredEnv "NCP_CLOVASTUDIO_API_KEY" }}

# OAuth
oauth:
  google:
    clientId: {{ requiredEnv "GOOGLE_CLIENT_ID" }}
    clientSecret: {{ requiredEnv "GOOGLE_CLIENT_SECRET" }}
    redirectUri: {{ requiredEnv "GOOGLE_REDIRECT_URI" }}
  naver:
    clientId: {{ requiredEnv "NAVER_CLIENT_ID" }}
    clientSecret: {{ requiredEnv "NAVER_CLIENT_SECRET" }}
    redirectUri: {{ requiredEnv "NAVER_REDIRECT_URI" }}

# Resources
resources:
  backend:
    requests: { memory: "512Mi", cpu: "200m" }
    limits:   { memory: "1Gi",   cpu: "500m" }
  frontend:
    requests: { memory: "32Mi",  cpu: "50m" }
    limits:   { memory: "128Mi", cpu: "200m" }
  worker:
    requests: { memory: "128Mi", cpu: "200m" }
    limits:   { memory: "256Mi", cpu: "500m" }
  arqWorker:
    requests: { memory: "256Mi", cpu: "100m" }
    limits:   { memory: "512Mi", cpu: "500m" }
  redis:
    requests: { memory: "128Mi", cpu: "50m" }
    limits:   { memory: "256Mi", cpu: "200m" }
    storage: 1Gi
  livekit:
    requests: { memory: "512Mi",   cpu: "500m" }
    limits:   { memory: "1Gi",   cpu: "1000m" }
